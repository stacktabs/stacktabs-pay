<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<title>StackTabs Activation</title>
<style>
body{
  font-family: Arial;
  text-align:center;
  padding-top:80px;
  background:#0f172a;
  color:white;
}
.box{
  background:#1e293b;
  padding:30px;
  border-radius:14px;
  display:inline-block;
}
</style>
</head>
<body>

<div class="box">
  <h2 id="status">Activating StackTabs Pro...</h2>
  <p>You can close this tab after activation.</p>
</div>

<script>
const params = new URLSearchParams(location.search);
const EXTENSION_ID = params.get("ext");

async function activate(){

  const email = prompt("Enter the email used for purchase:");

  if(!email){
    document.getElementById("status").innerText="Activation cancelled.";
    return;
  }

  try{

    const res = await fetch(
      "https://stacktabs-server.onrender.com/check?email="+encodeURIComponent(email)
    );

    const data = await res.json();

    if(!data.valid){
      document.getElementById("status").innerText="Payment not found ❌";
      return;
    }

    chrome.runtime.sendMessage(
      EXTENSION_ID,
      {
        type:"LICENSE_VALID",
        expiresAt:data.expiresAt
      },
      (response)=>{
        if(chrome.runtime.lastError){
          document.getElementById("status").innerText=
          "Extension not detected. Please install/reload StackTabs and reopen this page.";
          return;
        }

        document.getElementById("status").innerText="StackTabs Pro Activated ✅";
      }
    );

  }catch(e){
    document.getElementById("status").innerText="Server error. Try again.";
  }
}

activate();
</script>

</body>
</html>
