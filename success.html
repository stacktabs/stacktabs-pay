<script>
const params = new URLSearchParams(location.search);
const EXTENSION_ID = params.get("ext");

async function activate() {

  const email = prompt("Enter the email you used to purchase:");

  if(!email) return;

  const res = await fetch(
    "https://stacktabs-server.onrender.com/check?email=" + encodeURIComponent(email)
  );

  const data = await res.json();

  if(!data.valid){
    document.body.innerHTML="<h2>Payment not found ❌</h2>";
    return;
  }

  chrome.runtime.sendMessage(
    EXTENSION_ID,
    {
      type:"LICENSE_VALID",
      expiresAt:data.expiresAt
    },
    () => {
      document.body.innerHTML="<h2>StackTabs Pro Activated ✅</h2>";
    }
  );
}

activate();
</script>
